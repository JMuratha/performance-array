{"version":3,"file":"performance-array.spec.js","sourceRoot":"","sources":["../src/TQuery.ts","../src/IPerformanceArrayOptions.ts","../src/IndexFinder.ts","../src/specImports.spec.ts","../src/Utils.ts","../src/KeyStorage.ts","../src/SpecTestData.spec.ts","../src/IndexFinder.spec.ts","../src/KeyStorage.spec.ts","../src/KeyStorageQuerier.ts","../src/KeyStorageQuerier.spec.ts","../src/PerformanceArrayOptionsValidator.ts","../src/ItemExistsError.ts","../src/PerformanceArray.ts","../src/PerformanceArray.spec.ts","../src/PerformanceArrayOptionsValidator.spec.ts"],"names":[],"mappings":"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","sourcesContent":["namespace PerformanceArray {\n  export type TQuery = { [s: string]: any } ; //a map of property names to their queried value\n}\n","namespace PerformanceArray {\n  export interface IPerformanceArrayIndexOptions {\n    propertyNames: Array<string>;\n  }\n\n  export interface IPerformanceArrayOptions {\n    indices?: Array<IPerformanceArrayIndexOptions>;\n  }\n}","/// <reference path=\"./TQuery.ts\" />\n/// <reference path=\"./IPerformanceArrayOptions.ts\" />\n\nnamespace PerformanceArray {\n  export class IndexFinder {\n\n    private _options: IPerformanceArrayOptions;\n\n    /**\n     * \n     * @param options - have to be already validated\n     */\n    constructor(options: IPerformanceArrayOptions) {\n      this._options = options;\n    }\n\n    public findIndexOptionsForQuery(query: TQuery): IPerformanceArrayIndexOptions | null {\n      const propertyNames: Array<string> = Object.keys(query);\n\n      let currentMatchCount: number = 0;\n      let options: IPerformanceArrayIndexOptions = null;\n\n      for (const indexOpts of this._options.indices) {\n        const matchCount = this._findMatchCount(propertyNames, indexOpts.propertyNames);\n        if (matchCount > currentMatchCount) {\n          currentMatchCount = matchCount;\n          options = indexOpts;\n        }\n      }\n\n      return options;\n    }\n\n    private _findMatchCount(queryPropertyNames: Array<string>, indexPropertyNames: Array<string>): number {\n      //query can only be more inclusive than the index, but not less\n      if (queryPropertyNames.length < indexPropertyNames.length) {\n        return 0;\n      }\n\n      for (const indexPropertyName of indexPropertyNames) {\n        if (queryPropertyNames.indexOf(indexPropertyName) === -1) {\n          //query doesn't contain the whole index, we can't match that\n          return 0;\n        }\n      }\n\n      return indexPropertyNames.length;\n    }\n  }\n}","const expect: Chai.ExpectStatic = require('chai').expect;","namespace PerformanceArray {\n  export class Utils {\n    /**\n     * if the value is null or undefined, null is returned, else the value is returned\n     */\n    static normalizeUndefined(value: any): any {\n      return value != null ? value : null;\n    }\n  }\n}","/// <reference path=\"./TQuery.ts\" />\n/// <reference path=\"./IPerformanceArrayOptions.ts\" />\n/// <reference path=\"./Utils.ts\" />\n/// <reference path=\"./IndexFinder.ts\" />\n\n\nnamespace PerformanceArray {\n  type TIndexNameMap<T> = { [s: string]: { [s: string]: Array<T> } };\n\n  export class KeyStorage<T> {\n    private _options: IPerformanceArrayOptions;\n    private _indexNameMap: TIndexNameMap<T>;\n\n    /**\n     * \n     * @param {PerformanceArray.IPerformanceArrayOptions} options - must be already validated\n     */\n    constructor(options: IPerformanceArrayOptions) {\n      this._options = options;\n      this._createIndexNameMap();\n    }\n\n    public addItem(item: T) {\n      for (const indexOpts of this._options.indices) {\n        this._addItemToIndexNameMap(item, indexOpts);\n      }\n    }\n\n    public removeItem(item: T) {\n      for (const indexOpts of this._options.indices) {\n        this._removeItemFromIndexNameMapByValue(item, indexOpts);\n      }\n    }\n\n    public updateItem(item: T) {\n      for (const indexOpts of this._options.indices) {\n        const items = this.queryItemsByIndexOpts(item, indexOpts);\n\n        if (items.indexOf(item) === -1) {\n          this._removeItemFromIndexNameMap(item, indexOpts);\n          this._addItemToIndexNameMap(item, indexOpts);\n        }\n      }\n    }\n\n    /**\n     * \n     * @param query - all propertyNames of the indexOpts have to be present in the query!\n     * @param indexOpts \n     */\n    public queryItemsByIndexOpts(query: TQuery, indexOpts: IPerformanceArrayIndexOptions): Array<T> {\n      const indexMap = this._indexNameMap[this._generateIndexName(indexOpts)];\n      if (!indexMap) {\n        throw new Error(`[PerformanceArray] index for ${JSON.stringify(indexOpts)} doesn't exist`);\n      }\n\n      const items = indexMap[this._generateIndexValue(<any>query, indexOpts)];\n      return items ? items : [];\n    }\n\n    public createIndexFinder(): IndexFinder {\n      return new IndexFinder(this._options);\n    }\n    \n    private _createIndexNameMap() {\n      const map: TIndexNameMap<T> = {};\n\n      for (const indexOpts of this._options.indices) {\n        const indexName: string = this._generateIndexName(indexOpts);\n        map[indexName] = {};\n      }\n\n      this._indexNameMap = map;\n    }\n\n    private _addItemToIndexNameMap(item: T, indexOpts: IPerformanceArrayIndexOptions) {\n      const indexMap = this._indexNameMap[this._generateIndexName(indexOpts)];\n      const indexValue = this._generateIndexValue(item, indexOpts);\n\n      let items = indexMap[indexValue];\n      if (!items) {\n        items = indexMap[indexValue] = [];\n      }\n\n      if (items.indexOf(item) === -1) {\n        items.push(item);\n      }\n    }\n\n    /**\n     * removes the item from its correct index, this is the more performant version of _removeItemFromIndexNameMap\n     * but it only works when the item is stored correctly!\n     * \n     * @param item \n     * @param indexOpts \n     */\n    private _removeItemFromIndexNameMapByValue(item: T, indexOpts: IPerformanceArrayIndexOptions) {\n      const indexMap = this._indexNameMap[this._generateIndexName(indexOpts)];\n      const indexValue = this._generateIndexValue(item, indexOpts);\n\n      let items = indexMap[indexValue];\n\n      if (items) {\n        const index = items.indexOf(item);\n        if (index >= 0) {\n          items.splice(index, 1);\n        }\n      }\n    }\n\n    /**\n     * removes the item from the whole index specified\n     * \n     * @param item \n     * @param indexOpts \n     */\n    private _removeItemFromIndexNameMap(item: T, indexOpts: IPerformanceArrayIndexOptions) {\n      const indexMap = this._indexNameMap[this._generateIndexName(indexOpts)];\n\n      for (const key in indexMap) {\n        if (!indexMap.hasOwnProperty(key)) {\n          continue;\n        }\n\n        const items = indexMap[key];\n        const index = items.indexOf(item);\n\n        if (index >= 0) {\n          items.splice(index, 1);\n        }\n      }\n    }\n\n    private _generateIndexValue(item: T, indexOpts: IPerformanceArrayIndexOptions): string {\n      const valueMap: { [s: string]: T } = {};\n\n      for (const name of indexOpts.propertyNames) {\n        valueMap[name] = Utils.normalizeUndefined((<any>item)[name]);\n      }\n\n      let indexValue: string;\n\n      try {\n        indexValue = JSON.stringify(valueMap);\n      } catch (e) {\n        throw new Error('[PerformanceArray] Index couldn\\'t be serialized!');\n      }\n\n      return indexValue;\n    }\n\n    private _generateIndexName(indexOpts: IPerformanceArrayIndexOptions): string {\n      return JSON.stringify(indexOpts.propertyNames);\n    }\n  }\n}","/// <reference path=\"./KeyStorage.ts\" />\n/// <reference path=\"./IPerformanceArrayOptions.ts\" />\n\ntype TSpecTestDataUser = { id: number, name: string, value: number|null, unindexedProperty: string};\n\nclass SpecTestData {\n  public static frank: TSpecTestDataUser = {\n    id: 10,\n    name: 'frank',\n    value: 5,\n    unindexedProperty: 'frank is cool'\n  };\n\n  public static clara: TSpecTestDataUser = {\n    id: 20,\n    name: 'clara',\n    value: 50,\n    unindexedProperty: 'a cool text'\n  };\n\n  public static martin: TSpecTestDataUser = {\n    id: 30,\n    name: 'martin',\n    value: 15,\n    unindexedProperty: 'likes cars'\n  };\n\n  public static max: TSpecTestDataUser = {\n    id: 40,\n    name: 'max',\n    value: 150,\n    unindexedProperty: 'likes houses'\n  };\n\n  public static dara: TSpecTestDataUser = {\n    id: 50,\n    name: 'dara',\n    value: 50,\n    unindexedProperty: 'is a pilot'\n  };\n\n  public static karl: TSpecTestDataUser = {\n    id: 60,\n    name: 'karl',\n    value: null,\n    unindexedProperty: 'likes null'\n  };\n\n  public static stranger: TSpecTestDataUser = {\n    id: 70,\n    name: 'stranger',\n    value: undefined,\n    unindexedProperty: 'likes undefined'\n  };\n\n  public static idIndexOpts: PerformanceArray.IPerformanceArrayIndexOptions = {\n    propertyNames: ['id']\n  };\n\n  public static valueIndexOpts: PerformanceArray.IPerformanceArrayIndexOptions = {\n    propertyNames: ['value']\n  };\n\n  public static nameValueIndexOpts: PerformanceArray.IPerformanceArrayIndexOptions = {\n    propertyNames: ['name', 'value']\n  };\n\n  public static fillKeyStorageWithUsers(keyStorage: PerformanceArray.KeyStorage<TSpecTestDataUser>) {\n    this.generateUserList().forEach(u => keyStorage.addItem(u));\n  }\n\n  public static generateUserList(): Array<TSpecTestDataUser> {\n    return [\n      this.frank,\n      this.clara,\n      this.martin,\n      this.max,\n      this.dara,\n      this.stranger,\n      this.karl\n    ];\n  }\n\n  public static generatePerformanceArrayOptions(): PerformanceArray.IPerformanceArrayOptions {\n    return {\n      indices: [\n        this.idIndexOpts,\n        this.valueIndexOpts,\n        this.nameValueIndexOpts\n      ]\n    };\n  }\n}","/// <reference path=\"./IndexFinder.ts\" />\n/// <reference path=\"./specImports.spec.ts\" />\n/// <reference path=\"./SpecTestData.spec.ts\" />\n\ndescribe('IndexFinder', () => {\n\n  let indexFinder: PerformanceArray.IndexFinder;\n\n  beforeEach(() => {\n    indexFinder = new PerformanceArray.IndexFinder(SpecTestData.generatePerformanceArrayOptions());\n  });\n\n  it('should find the id index', () => {\n    const indexOptions = indexFinder.findIndexOptionsForQuery({ id: 10 });\n    expect(indexOptions).to.be.equal(SpecTestData.idIndexOpts);\n  });\n\n  it('should find the nameValue index', () => {\n    const indexOptions = indexFinder.findIndexOptionsForQuery({ name: 'franz', value: null });\n    expect(indexOptions).to.be.equal(SpecTestData.nameValueIndexOpts);\n  });\n\n  it('should find the value index', () => {\n    const indexOptions = indexFinder.findIndexOptionsForQuery({ value: null, someProperty: '20' });\n    expect(indexOptions).to.be.equal(SpecTestData.valueIndexOpts);\n  });\n\n  it('should find no index', () => {\n    const indexOptions = indexFinder.findIndexOptionsForQuery({ someProperty: '20' });\n    expect(indexOptions).to.be.null;\n  });\n});","/// <reference path=\"./KeyStorage.ts\" />\n/// <reference path=\"./specImports.spec.ts\" />\n/// <reference path=\"./SpecTestData.spec.ts\" />\n\ndescribe('KeyStorage', () => {\n\n  let keyStorage: PerformanceArray.KeyStorage<TSpecTestDataUser>;\n\n  beforeEach(() => {\n    keyStorage = new PerformanceArray.KeyStorage(SpecTestData.generatePerformanceArrayOptions());\n    SpecTestData.fillKeyStorageWithUsers(keyStorage);\n  });\n\n  it('should find an item by the id', () => {\n    const result = keyStorage.queryItemsByIndexOpts({ id: SpecTestData.frank.id }, SpecTestData.idIndexOpts);\n    expect(result[0]).to.be.equal(SpecTestData.frank);\n  });\n\n  it('should handle null and undefined in the same way', () => {\n    const result = keyStorage.queryItemsByIndexOpts({ value: null }, SpecTestData.valueIndexOpts);\n    expect(result).to.have.length(2, 'to find 2 items');\n    expect(result).to.contain(SpecTestData.stranger, 'to find stranger');\n    expect(result).to.contain(SpecTestData.karl, 'to find karl');\n  });\n\n  it('should find items with an combined index', () => {\n    const query: PerformanceArray.TQuery = { name: SpecTestData.max.name, value: SpecTestData.max.value };\n    const result = keyStorage.queryItemsByIndexOpts(query, SpecTestData.nameValueIndexOpts);\n    expect(result, 'to find max').to.deep.equal([SpecTestData.max]);\n  });\n\n  it('should be able to remove items', () => {\n    keyStorage.removeItem(SpecTestData.clara);\n    expect(keyStorage.queryItemsByIndexOpts({ id: SpecTestData.clara.id }, SpecTestData.idIndexOpts)).to.be.empty;\n  });\n\n  it('should move updated item to the correct index', () => {\n    const oldId: number = SpecTestData.dara.id;\n    const newId: number = ++SpecTestData.dara.id;\n\n    const oldIndexItem = keyStorage.queryItemsByIndexOpts({ id: oldId }, SpecTestData.idIndexOpts)[0];\n    expect(oldIndexItem, 'to find item in old index before updating').to.be.equal(SpecTestData.dara);\n    keyStorage.updateItem(SpecTestData.dara);\n\n    const oldIndexNewItem = keyStorage.queryItemsByIndexOpts({ id: oldId }, SpecTestData.idIndexOpts)[0];\n    expect(oldIndexNewItem, 'to not find item in old index after updating').to.be.undefined;\n    const newIndexItem = keyStorage.queryItemsByIndexOpts({ id: newId }, SpecTestData.idIndexOpts)[0];\n    expect(newIndexItem, 'to find item in new index after updating').to.be.equal(SpecTestData.dara);\n  });\n});","/// <reference path=\"./KeyStorage.ts\" />\n/// <reference path=\"./IndexFinder.ts\" />\n/// <reference path=\"./TQuery.ts\" />\n/// <reference path=\"./Utils.ts\" />\n\nnamespace PerformanceArray {\n\n  type TKeyStorageQuerierMissingQueryProperty = { key: string, value: any };\n\n  export class KeyStorageQuerier<T> {\n\n    private _keyStorage: KeyStorage<T>;\n    private _allItems: Array<T>;\n    private _indexFinder: IndexFinder;\n\n    constructor(keyStorage: KeyStorage<T>, allItems: Array<T>) {\n      this._keyStorage = keyStorage;\n      this._indexFinder = keyStorage.createIndexFinder();\n      this._allItems = allItems;\n    }\n\n    public executeQuery(query: TQuery): Array<T> {\n      const indexOptions: IPerformanceArrayIndexOptions = this._indexFinder.findIndexOptionsForQuery(query);\n      const items = this._getItemsForIndexOptions(query, indexOptions);\n      const missingQueryProperties = this._getMissingQueryProperties(query, indexOptions);\n      return this._filterItemsByMissingQueryProperties(items, missingQueryProperties);\n    }\n\n    private _getItemsForIndexOptions(query: TQuery, indexOptions: IPerformanceArrayIndexOptions): Array<T> {\n      if (indexOptions) {\n        return this._keyStorage.queryItemsByIndexOpts(query, indexOptions);\n      } else {\n        return this._allItems.slice();\n      }\n    }\n\n    private _getMissingQueryProperties(query: TQuery, indexOptions?: IPerformanceArrayIndexOptions | null):\n      Array<TKeyStorageQuerierMissingQueryProperty> {\n\n      const missingOptions: Array<TKeyStorageQuerierMissingQueryProperty> = [];\n\n      for (const key in query) {\n        if (!query.hasOwnProperty(key)) {\n          continue;\n        }\n\n        if (!indexOptions || indexOptions.propertyNames.indexOf(key) === -1) {\n          missingOptions.push({\n            key: key,\n            value: Utils.normalizeUndefined(query[key])\n          });\n        }\n      }\n\n      return missingOptions;\n    }\n\n    private _filterItemsByMissingQueryProperties(items: Array<T>,\n      missingQueryProperties: Array<TKeyStorageQuerierMissingQueryProperty>) {\n\n      if (missingQueryProperties.length === 0) {\n        return items;\n      } else {\n        return items.filter((item) => {\n          for (let key = 0; key < missingQueryProperties.length; key++) {\n            const missingProp = missingQueryProperties[key];\n\n            if (Utils.normalizeUndefined((<any>item)[missingProp.key]) !== missingProp.value) {\n              return false;\n            }\n          }\n\n          return true;\n        });\n      }\n    }\n  }\n}","/// <reference path=\"./KeyStorage.ts\" />\n/// <reference path=\"./KeyStorageQuerier.ts\" />\n/// <reference path=\"./specImports.spec.ts\" />\n/// <reference path=\"./SpecTestData.spec.ts\" />\n\ndescribe('KeyStorageQuerier', () => {\n  const keyStorage = new PerformanceArray.KeyStorage<TSpecTestDataUser>(SpecTestData.generatePerformanceArrayOptions());\n  const users: Array<TSpecTestDataUser> = SpecTestData.generateUserList();\n  const keyStorageQuerier = new PerformanceArray.KeyStorageQuerier<TSpecTestDataUser>(keyStorage, users);\n  SpecTestData.fillKeyStorageWithUsers(keyStorage);\n\n  it('should find frank by id', () => {\n    const result = keyStorageQuerier.executeQuery({ id: SpecTestData.frank.id });\n    expect(result).to.have.length(1, 'to only find one item');\n    expect(result[0]).to.equal(SpecTestData.frank, 'to have frank as the first item');\n  });\n\n  it('should find clara and dara by value', () => {\n    const result = keyStorageQuerier.executeQuery({ value: SpecTestData.clara.value });\n    expect(result).to.have.length(2, 'to only find 2 items');\n    expect(result).to.contain(SpecTestData.clara, 'to find clara');\n    expect(result).to.contain(SpecTestData.dara, 'to find dara');\n  });\n\n  it('should not find items with a non existing unindexedProperty', () => {\n    const result = keyStorageQuerier.executeQuery({ unindexedProperty: 'this value doesn\\'t exist' });\n    expect(result).to.have.length(0, 'to not find an item');\n  });\n\n  it('should find max by the unindexedProperty', () => {\n    const result = keyStorageQuerier.executeQuery({ unindexedProperty: SpecTestData.max.unindexedProperty });\n    expect(result).to.have.length(1, 'to only find 1 item');\n    expect(result).to.contain(SpecTestData.max, 'to find max');\n  });\n\n  it('should find martin by the unindexedProperty + id', () => {\n    const result = keyStorageQuerier.executeQuery({\n      id: SpecTestData.martin.id,\n      unindexedProperty: SpecTestData.martin.unindexedProperty\n    });\n    expect(result).to.have.length(1, 'to only find 1 item');\n    expect(result).to.contain(SpecTestData.martin, 'to find martin');\n  });\n});","/// <reference path=\"./IPerformanceArrayOptions.ts\" />\n\n\nnamespace PerformanceArray {\n  interface IAvailableKeyInfo {\n    name: string;\n    type: any;\n    subType?: any; //for arrays which don't need further validation than the type\n    subKeyInfos?: Array<IAvailableKeyInfo>; //only works on objects/array of objects\n  }\n\n  export class PerformanceArrayOptionsValidator {\n\n    private _options: IPerformanceArrayOptions;\n\n    private static _availableKeyInfos: Array<IAvailableKeyInfo> = [\n      {\n        name: 'indices',\n        type: Array,\n        subKeyInfos: [\n          {\n            name: 'propertyNames',\n            type: Array,\n            subType: String\n          }\n        ]\n      }\n    ];\n\n    constructor(options: IPerformanceArrayOptions) {\n      this._options = options;\n    }\n\n    /**\n     * return true if the options object is valid, else it will throw an exception with a description\n     */\n    public validate(): boolean {\n      this._validateObject(this._options, PerformanceArrayOptionsValidator._availableKeyInfos);\n      return true;\n    }\n\n    private _validateObject(obj: Object, availableKeyInfos: Array<IAvailableKeyInfo>, optionPath: string = '') {\n      for (let key in obj) {\n        const value = (<any>obj)[key];\n        if (!obj.hasOwnProperty(key)) {\n          continue;\n        }\n\n        this._validateKeyValue(key, value, availableKeyInfos, optionPath + '.' + key);\n      }\n    }\n\n    // tslint:disable-next-line:max-line-length\n    private _validateKeyValue(key: string, value: any, availableKeyInfos: Array<IAvailableKeyInfo>, optionPath: string) {\n      const info = this._getAvailableKeyInfoByName(key, availableKeyInfos);\n      if (!info) {\n        throw new Error(`[PerformanceArray] invalid option ${key}`);\n      }\n\n      if (value.constructor !== info.type) {\n        throw new Error(\n          `[PerformanceArray] expected type ${this._getNameOfClass(info.type)}`\n          + ` but got type ${this._getNameOfClass(value.constructor)} instead for ${key}`\n        );\n      }\n\n      if (value.constructor === Array && info.subType) {\n        this._validateArraySubType(value, info.subType, optionPath);\n      }\n\n      if (info.subKeyInfos) {\n        if (value.constructor === Array) {\n          value.forEach((item: any, index: number) => {\n            return this._validateObject(item, info.subKeyInfos, optionPath + '.' + index);\n          });\n        } else {\n          this._validateObject(value, info.subKeyInfos, optionPath);\n        }\n      }\n    }\n\n    private _validateArraySubType(array: Array<any>, itemType: any, optionsPath: string) {\n      array.forEach((item, index) => {\n        if (item.constructor !== itemType) {\n          throw new Error(\n            `[PerformanceArray] expected type ${this._getNameOfClass(item.constructor)}`\n            + ` but got type ${this._getNameOfClass(item.constructor)} instead for `\n            + optionsPath + '.' + index\n          );\n        }\n      });\n    }\n\n    private _getNameOfClass(cl: any): string | null {\n      const result = /function ([^)]*)\\(/.exec(String(cl));\n      return result ? result[1] : null;\n    }\n\n    private _getAvailableKeyInfoByName(name: string, availableKeyInfos: Array<IAvailableKeyInfo>)\n      : IAvailableKeyInfo | undefined {\n      for (let key = 0; key < availableKeyInfos.length; key++) {\n        if (availableKeyInfos[key].name === name) {\n          return availableKeyInfos[key];\n        }\n      }\n\n      return null;\n    }\n  }\n}","namespace PerformanceArray{\n  export class ItemExistsError<T> extends Error {\n    public item: T;\n    \n    constructor(item: T) {\n      super('The item has already been added');\n      this.item = item;\n    } \n  } \n} ","/// <reference path=\"./IPerformanceArrayOptions.ts\" />\n/// <reference path=\"./PerformanceArrayOptionsValidator.ts\" />\n/// <reference path=\"./KeyStorage.ts\" />\n/// <reference path=\"./KeyStorageQuerier.ts\" />\n/// <reference path=\"./ItemExistsError.ts\" />\n\nnamespace PerformanceArray {\n  export class PerformanceArray<T> {\n\n    private _arrayData: Array<T>;\n    private _keyStorage: KeyStorage<T>;\n    private _querier: KeyStorageQuerier<T>;\n\n    constructor(arrayData: Array<T>, options: IPerformanceArrayOptions) {\n      const validator = new PerformanceArrayOptionsValidator(options);\n      validator.validate();\n      \n      this._arrayData = arrayData;\n      this._keyStorage = new KeyStorage(options);\n      this._querier = new KeyStorageQuerier(this._keyStorage, this._arrayData);\n\n      this._arrayData.forEach(item => this._keyStorage.addItem(item));\n    }\n\n    public item(i: number): T {\n      return this._arrayData[i];\n    }\n\n    public remove(item: T) {\n      const index = this._arrayData.indexOf(item);\n      this.splice(index, 1);\n    }\n\n    public push(item: T) {\n      this._checkItemBeforeAdding(item);\n      this._arrayData.push(item);\n      this._keyStorage.addItem(item);\n    }\n\n    public pop(): T | undefined {\n      const item: T = this._arrayData.pop();\n\n      if (item) {\n        this._keyStorage.removeItem(item);\n      }\n\n      return item;\n    }\n\n    public unshift(item: T) {\n      this._checkItemBeforeAdding(item);\n      this._arrayData.unshift(item);\n      this._keyStorage.addItem(item);\n    }\n\n    public shift(): T | undefined {\n      const item: T = this._arrayData.shift();\n\n      if (item) {\n        this._keyStorage.removeItem(item);\n      }\n\n      return item;\n    }\n\n    /**\n     * returns the removed items\n     * \n     * @param index \n     * @param deleteCount \n     * @param insertItems \n     */\n    public splice(index: number, deleteCount: number, ...insertItems: Array<T>): Array<T> {\n      insertItems.forEach(item => this._checkItemBeforeAdding(item));\n\n      const spliceArgs = [index, deleteCount, ...insertItems];\n      const removedItems: Array<T> = this._arrayData.splice.apply(this._arrayData, spliceArgs);\n\n      removedItems.forEach(item => this._keyStorage.removeItem(item));\n      insertItems.forEach(item => this._keyStorage.addItem(item));\n\n      return removedItems;\n    }\n\n    public toArray(): Array<T> {\n      return this._arrayData.slice();\n    }\n\n    public get length(): number {\n      return this._arrayData.length;\n    }\n\n    /**\n     * get the first item matching the query\n     * \n     * @param {PerformanceArray.TQuery} query \n     */\n    public findItem(query: TQuery): T {\n      //TODO: improve performance by exiting on the first item found in the querier\n      return this._querier.executeQuery(query)[0];\n    }\n\n    /**\n     * get all items matching the query\n     * \n     * @param {PerformanceArray.TQuery} query \n     */\n    public findItems(query: TQuery): Array<T> {\n      return this._querier.executeQuery(query);\n    }\n\n    public hasItem(item: T): boolean {\n      const items = this._querier.executeQuery(item);\n      return items.indexOf(item) >= 0;\n    }\n\n    private _checkItemBeforeAdding(item: T) {\n      if (this.hasItem(item)) {\n        throw new ItemExistsError<T>(item);\n      }\n    }\n  }\n}","/// <reference path=\"./PerformanceArray.ts\" />\n/// <reference path=\"./specImports.spec.ts\" />\n/// <reference path=\"./SpecTestData.spec.ts\" />\n\ndescribe('PerformanceArray', () => {\n  let userList: Array<TSpecTestDataUser>;\n  let performanceArray: PerformanceArray.PerformanceArray<TSpecTestDataUser>;\n\n  beforeEach(() => {\n    userList = SpecTestData.generateUserList();\n    performanceArray = new PerformanceArray.PerformanceArray(userList, SpecTestData.generatePerformanceArrayOptions());\n  });\n\n  it('should be convertible to an array', () => {\n    const resultData = performanceArray.toArray();\n\n    userList.forEach((item, index) => {\n      expect(item).to.be.equal(resultData[index], `data at index ${index} is equal`);\n    });\n\n    expect(userList).to.not.be.equal(resultData, 'result array should not be equal to input array');\n  });\n\n  it('can access items at a certain index', () => {\n    expect(userList[0]).to.be.equal(performanceArray.item(0), 'item at index 2 is the same');\n    expect(userList[2]).to.be.equal(performanceArray.item(2), 'item at index 2 is the same');\n    expect(performanceArray.item(5000), 'item at out of bounds index is undefined').to.be.undefined;\n  });\n\n  it('can push a new item', () => {\n    const item: TSpecTestDataUser = { id: 101010, name: 'new user', value: 70, unindexedProperty: 'whatever' };\n    performanceArray.push(item);\n    expect(performanceArray.item(performanceArray.length - 1)).to.be.equal(item, 'item is the last item');\n    expect(performanceArray.findItem({ id: item.id })).to.be.equal(item, 'item can be correctly found');\n  });\n\n  it('can pop an item', () => {\n    const item = performanceArray.item(performanceArray.length - 1);\n    const oldLength = performanceArray.length;\n\n    const poppedItem = performanceArray.pop();\n    expect(poppedItem).to.be.equal(item, 'popped item was the last item');\n    expect(performanceArray.length).to.be.equal(oldLength - 1, 'arrays length decreased by one');\n    expect(performanceArray.findItem({ id: poppedItem.id })).to.be.equal(undefined, 'item cannot be found anymore');\n  });\n\n  it('can shift an item', () => {\n    const item = performanceArray.item(0);\n    const oldLength = performanceArray.length;\n\n    const shiftedItem = performanceArray.shift();\n    expect(shiftedItem).to.be.equal(item, 'shifted item is the first item');\n    expect(performanceArray.length).to.be.equal(oldLength - 1, 'arrays length decreased by one');\n    expect(performanceArray.findItem({ id: shiftedItem.id })).to.be.equal(undefined, 'item cannot be found anymore');\n  });\n\n  it('can unshift a new item', () => {\n    const item = { id: 101010, name: 'new user', value: 70, unindexedProperty: 'whatever' };\n    const oldLength = performanceArray.length;\n    performanceArray.unshift(item);\n    expect(performanceArray.item(0)).to.be.equal(item, 'item has been inserted at index 0');\n    expect(performanceArray.length).to.be.equal(oldLength + 1, 'arrays length increased by one');\n    expect(performanceArray.findItem({ id: item.id })).to.be.equal(item, 'item can be correctly found');\n  });\n\n  it('can splice items', () => {\n    const newItem = { id: 101010, name: 'new user', value: 70, unindexedProperty: 'whatever' };\n    const oldLength = performanceArray.length;\n    const itemThatShouldBeRemoved = performanceArray.item(2);\n    const removedItem = performanceArray.splice(2, 1, newItem)[0];\n\n    expect(removedItem).to.be.equal(itemThatShouldBeRemoved, 'removed the correct item');\n    expect(performanceArray.findItem({ id: removedItem.id })).to.be.equal(undefined, 'item cannot be found anymore');\n    expect(performanceArray.length).to.be.equal(oldLength, 'array has the same length as before');\n    expect(performanceArray.item(2)).to.be.equal(newItem, 'added the new item at the correct index');\n    expect(performanceArray.findItem({ id: newItem.id })).to.be.equal(newItem, 'new item can be correctly found');\n  });\n\n  it('throws an error on adding an existing item', () => {\n    const pushFunction: Function = performanceArray.push.bind(performanceArray, SpecTestData.clara);\n    expect(pushFunction).to.throw(/The item has already been added/, 'can\\'t add an existing item');\n  });\n});","/// <reference path=\"./PerformanceArrayOptionsValidator.ts\" />\n/// <reference path=\"./specImports.spec.ts\" />\n\ndescribe('PerformanceArrayOptionsValidator', () => {\n\n  it('should allow and empty object', () => {\n    const validator = new PerformanceArray.PerformanceArrayOptionsValidator({});\n    validator.validate();\n  });\n\n  it('should throw an error on an unknown key', () => {\n    let error: Error = null;\n\n    try {\n      const validator = new PerformanceArray.PerformanceArrayOptionsValidator(\n        (<any>{ powderThatMakesYouSayYes: 'yes' })\n      );\n      validator.validate();\n    } catch (e) {\n      error = e;\n    }\n\n    expect(error).to.not.be.null;\n  });\n\n  it('should throw an error on an invalid index option key', () => {\n    let error: Error = null;\n\n    try {\n      const validator = new PerformanceArray.PerformanceArrayOptionsValidator((<any>{\n        indices: [{ powderThatMakesYouSayYes: 'yes' }]\n      }));\n      validator.validate();\n    } catch (e) {\n      error = e;\n    }\n\n    expect(error).to.not.be.null;\n  });\n\n  it('should throw an error on an invalid index property name', () => {\n    let error: Error = null;\n\n    try {\n      const validator = new PerformanceArray.PerformanceArrayOptionsValidator((<any>{\n        indices: [{\n          propertyNames: [{}]\n        }]\n      }));\n      validator.validate();\n    } catch (e) {\n      error = e;\n    }\n\n    expect(error).to.not.be.null;\n  });\n\n  it('should validate a fully configured options object', () => {\n    const validator = new PerformanceArray.PerformanceArrayOptionsValidator({\n      indices: [\n        {\n          propertyNames: ['id']\n        }\n      ]\n    });\n    validator.validate();\n  });\n});"]}